<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Quittance de Loyer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px; /* Base font size for rem calculations */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            font-size: 1rem;
        }

        .container {
            max-width: 75rem; /* 1200px */
            margin: 0 auto;
            padding: 1.25rem; /* 20px */
        }

        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.875rem; /* 30px */
            border-radius: 0.9375rem; /* 15px */
            margin-bottom: 1.875rem; /* 30px */
            box-shadow: 0 0.5rem 1.5625rem rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem); /* Responsive font size */
            margin-bottom: 0.625rem; /* 10px */
            font-weight: 300;
        }

        .header p {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.875rem; /* 30px */
            margin-bottom: 1.875rem; /* 30px */
        }

        @media (max-width: 60.5rem) { /* 968px */
            .main-content {
                grid-template-columns: 1fr;
                gap: 1.25rem; /* 20px */
            }
        }

        .form-section, .preview-section {
            background: white;
            padding: 1.875rem; /* 30px */
            border-radius: 0.9375rem; /* 15px */
            box-shadow: 0 0.3125rem 1.25rem rgba(0,0,0,0.08);
            border: 1px solid #e1e5e9;
        }

        @media (max-width: 48rem) { /* 768px */
            .form-section, .preview-section {
                padding: 1.25rem; /* 20px */
            }
        }

        @media (max-width: 30rem) { /* 480px */
            .form-section, .preview-section {
                padding: 1rem; /* 16px */
            }
        }

        .section-title {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            margin-bottom: 1.25rem; /* 20px */
            color: #2c3e50;
            border-bottom: 0.125rem solid #667eea; /* 2px */
            padding-bottom: 0.625rem; /* 10px */
        }

        .form-group {
            margin-bottom: 1.25rem; /* 20px */
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem; /* 8px */
            font-weight: 600;
            color: #555;
            font-size: clamp(0.875rem, 2vw, 1rem);
        }

        .required {
            color: #e74c3c;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem 0.9375rem; /* 12px 15px */
            border: 0.125rem solid #e1e5e9; /* 2px */
            border-radius: 0.5rem; /* 8px */
            font-size: clamp(0.875rem, 2vw, 1rem);
            transition: border-color 0.3s ease;
            background-color: #fafafa;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background-color: white;
            box-shadow: 0 0 0 0.1875rem rgba(102, 126, 234, 0.1); /* 3px */
        }

        .form-group textarea {
            resize: vertical;
            min-height: 5rem; /* 80px */
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.9375rem; /* 15px */
        }

        @media (max-width: 37.5rem) { /* 600px */
            .form-row {
                grid-template-columns: 1fr;
                gap: 0.625rem; /* 10px */
            }
        }

        .signature-section {
            border: 0.125rem dashed #ccc; /* 2px */
            padding: 1.25rem; /* 20px */
            border-radius: 0.625rem; /* 10px */
            text-align: center;
            margin-top: 1.25rem; /* 20px */
            background-color: #fafafa;
        }

        .signature-options {
            display: flex;
            justify-content: center;
            gap: 1.25rem; /* 20px */
            margin-bottom: 1.25rem; /* 20px */
            flex-wrap: wrap;
        }

        .signature-btn {
            padding: 0.625rem 1.25rem; /* 10px 20px */
            background: #667eea;
            color: white;
            border: none;
            border-radius: 0.5rem; /* 8px */
            cursor: pointer;
            font-size: clamp(0.75rem, 2vw, 0.875rem);
            transition: background 0.3s ease;
            min-width: 7rem; /* Minimum width for better touch targets */
            min-height: 2.5rem; /* Minimum height for better touch targets */
        }

        .signature-btn:hover {
            background: #5a6fd8;
        }

        .signature-btn.active {
            background: #4c63d2;
        }

        #signatureCanvas {
            border: 0.125rem solid #ddd; /* 2px */
            border-radius: 0.5rem; /* 8px */
            cursor: crosshair;
            background: white;
            display: none;
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 30rem) { /* 480px */
            #signatureCanvas {
                width: 100%;
                height: 9.375rem; /* 150px */
            }
        }

        .canvas-controls {
            margin-top: 0.625rem; /* 10px */
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.625rem;
        }

        .canvas-controls button {
            padding: 0.5rem 1rem; /* 8px 16px */
            margin: 0;
            border: 1px solid #ddd;
            background: white;
            border-radius: 0.3125rem; /* 5px */
            cursor: pointer;
            font-size: 0.875rem;
            min-height: 2.25rem; /* Better touch target */
        }

        .canvas-controls button:hover {
            background: #f0f0f0;
        }

        #fileUpload {
            display: none;
        }

        .signature-preview {
            margin-top: 0.9375rem; /* 15px */
            display: none;
        }

        .signature-preview img {
            max-width: 12.5rem; /* 200px */
            max-height: 6.25rem; /* 100px */
            border: 1px solid #ddd;
            border-radius: 0.3125rem; /* 5px */
        }

        .btn {
            padding: 0.9375rem 1.875rem; /* 15px 30px */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 0.5rem; /* 8px */
            cursor: pointer;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
            margin-top: 1.25rem; /* 20px */
            min-height: 3rem; /* Better touch target */
        }

        .btn:hover {
            transform: translateY(-0.125rem); /* 2px */
            box-shadow: 0 0.5rem 1.5625rem rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.875rem;
            margin-top: 0.3125rem; /* 5px */
            display: none;
        }

        .preview-content {
            background: white;
            padding: 2.5rem; /* 40px */
            border: 1px solid #ddd;
            border-radius: 0.625rem; /* 10px */
            margin-top: 1.25rem; /* 20px */
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            min-height: 37.5rem; /* 600px */
            font-size: clamp(0.75rem, 2vw, 0.875rem);
        }

        @media (max-width: 48rem) { /* 768px */
            .preview-content {
                padding: 1.25rem; /* 20px */
                min-height: 25rem; /* 400px */
            }
        }

        @media (max-width: 30rem) { /* 480px */
            .preview-content {
                padding: 1rem; /* 16px */
                min-height: 20rem; /* 320px */
            }
        }

        .preview-header {
            text-align: center;
            margin-bottom: 1.875rem; /* 30px */
        }

        .preview-header h2 {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            margin-bottom: 0.625rem; /* 10px */
            color: #2c3e50;
        }

        .preview-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.25rem; /* 20px */
            margin-bottom: 1.875rem; /* 30px */
        }

        @media (max-width: 48rem) { /* 768px */
            .preview-info {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        .preview-block {
            margin-bottom: 1.25rem; /* 20px */
        }

        .preview-block strong {
            display: block;
            margin-bottom: 0.3125rem; /* 5px */
            color: #2c3e50;
            font-size: clamp(0.875rem, 2vw, 1rem);
        }

        .preview-block div {
            font-size: clamp(0.75rem, 2vw, 0.875rem);
        }

        .preview-content-main {
            margin: 1.875rem 0; /* 30px */
            text-align: justify;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            line-height: 1.7;
        }

        .preview-details {
            border: 1px solid #ddd;
            padding: 1.25rem; /* 20px */
            margin: 1.25rem 0; /* 20px */
            border-radius: 0.5rem; /* 8px */
            background: #f9f9f9;
        }

        @media (max-width: 30rem) { /* 480px */
            .preview-details {
                padding: 1rem;
                margin: 1rem 0;
            }
        }

        .preview-details h3 {
            font-size: clamp(1rem, 2.5vw, 1.125rem);
            margin-bottom: 0.625rem;
        }

        .preview-details table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.625rem; /* 10px */
            font-size: clamp(0.75rem, 2vw, 0.875rem);
        }

        .preview-details td {
            padding: 0.5rem; /* 8px */
            border-bottom: 1px solid #ddd;
            vertical-align: top;
        }

        @media (max-width: 30rem) { /* 480px */
            .preview-details td {
                padding: 0.375rem; /* 6px */
                font-size: 0.75rem;
            }
        }

        .preview-signature {
            margin-top: 2.5rem; /* 40px */
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap;
            gap: 1.25rem; /* 20px */
        }

        @media (max-width: 48rem) { /* 768px */
            .preview-signature {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.25rem;
            }
        }

        .signature-placeholder {
            border: 0.125rem dashed #ccc; /* 2px */
            width: 12.5rem; /* 200px */
            height: 5rem; /* 80px */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 0.875rem;
        }

        @media (max-width: 30rem) { /* 480px */
            .signature-placeholder {
                width: 100%;
                max-width: 10rem; /* 160px */
                height: 4rem; /* 64px */
            }
        }

        .signature-image {
            max-width: 12.5rem; /* 200px */
            max-height: 5rem; /* 80px */
        }

        @media (max-width: 30rem) { /* 480px */
            .signature-image {
                max-width: 10rem; /* 160px */
                max-height: 4rem; /* 64px */
            }
        }

        .help-section {
            background: #e8f4ff;
            border-left: 0.25rem solid #667eea; /* 4px */
            padding: 1.25rem; /* 20px */
            margin-top: 1.25rem; /* 20px */
            border-radius: 0.5rem; /* 8px */
        }

        .help-section h3 {
            color: #2c3e50;
            margin-bottom: 0.625rem; /* 10px */
            font-size: clamp(1rem, 2.5vw, 1.125rem);
        }

        .help-section ul {
            margin-left: 1.25rem; /* 20px */
        }

        .help-section li {
            margin-bottom: 0.3125rem; /* 5px */
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            line-height: 1.5;
        }

        .footer {
            text-align: center;
            padding: 1.25rem; /* 20px */
            background: #2c3e50;
            color: white;
            border-radius: 0.9375rem; /* 15px */
            margin-top: 1.875rem; /* 30px */
        }

        .footer p {
            margin-bottom: 0.3125rem; /* 5px */
            font-size: clamp(0.875rem, 2vw, 1rem);
        }

        .footer small {
            font-size: clamp(0.75rem, 1.5vw, 0.875rem);
        }

        .legal-text {
            font-size: clamp(0.7rem, 1.5vw, 0.75rem);
            color: #666;
            margin-top: 1.25rem; /* 20px */
            text-align: center;
            line-height: 1.4;
        }

        .validation-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 0.625rem; /* 10px */
            border-radius: 0.3125rem; /* 5px */
            margin-bottom: 1.25rem; /* 20px */
            display: none;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 0.625rem; /* 10px */
            border-radius: 0.3125rem; /* 5px */
            margin-bottom: 1.25rem; /* 20px */
            display: none;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }

        /* Améliorations pour les très petits écrans */
        @media (max-width: 20rem) { /* 320px */
            .container {
                padding: 0.5rem; /* 8px */
            }

            .header {
                padding: 1rem; /* 16px */
                margin-bottom: 1rem; /* 16px */
            }

            .form-section, .preview-section {
                padding: 0.75rem; /* 12px */
            }

            .signature-options {
                flex-direction: column;
                align-items: center;
                gap: 0.5rem;
            }

            .signature-btn {
                width: 100%;
                max-width: 10rem;
            }
        }

        /* Améliorations pour les très grands écrans */
        @media (min-width: 90rem) { /* 1440px */
            html {
                font-size: 18px; /* Slightly larger base font size */
            }

            .container {
                max-width: 80rem; /* 1280px with larger font */
            }
        }

        /* Améliorations pour l'impression */
        @media print {
            .form-section {
                display: none;
            }

            .preview-section {
                box-shadow: none;
                border: none;
                margin: 0;
                padding: 0;
            }

            .header, .help-section, .footer {
                display: none;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 0;
                margin: 0;
            }

            .preview-content {
                margin: 0;
                padding: 1rem;
                font-size: 0.9rem;
            }
        }

        /* Améliorations pour l'accessibilité */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Mode sombre (si supporté par le navigateur) */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #e0e0e0;
            }

            .form-section, .preview-section, .preview-content {
                background: #2d2d2d;
                color: #e0e0e0;
                border-color: #404040;
            }

            .form-group input,
            .form-group textarea,
            .form-group select {
                background-color: #404040;
                border-color: #606060;
                color: #e0e0e0;
            }

            .form-group input:focus,
            .form-group textarea:focus,
            .form-group select:focus {
                background-color: #4a4a4a;
                border-color: #667eea;
            }

            .signature-section {
                background-color: #404040;
                border-color: #606060;
            }

            .preview-details {
                background: #404040;
                border-color: #606060;
            }

            .help-section {
                background: #1e3a5f;
                border-left-color: #667eea;
            }
        }

        /* Orientation paysage sur mobile */
        @media (max-width: 48rem) and (orientation: landscape) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }

            .preview-info {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Ajustements pour les écrans tactiles */
        @media (hover: none) and (pointer: coarse) {
            .form-group input,
            .form-group textarea,
            .form-group select,
            .btn,
            .signature-btn {
                min-height: 2.75rem; /* 44px - taille recommandée pour le tactile */
            }

            .canvas-controls button {
                min-height: 2.75rem;
                padding: 0.75rem 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📋 Générateur de Quittance de Loyer</h1>
            <p>Créez facilement vos quittances de loyer professionnelles</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h2 class="section-title">📝 Informations de la quittance</h2>
                
                <div class="validation-message" id="validationMessage"></div>
                <div class="success-message" id="successMessage"></div>

                <form id="receiptForm">
                    <div class="form-group">
                        <label for="landlordName">Nom du bailleur <span class="required">*</span></label>
                        <input type="text" id="landlordName" required>
                        <div class="error-message" id="landlordNameError"></div>
                    </div>

                    <div class="form-group">
                        <label for="landlordAddress">Adresse du bailleur <span class="required">*</span></label>
                        <textarea id="landlordAddress" rows="3" required></textarea>
                        <div class="error-message" id="landlordAddressError"></div>
                    </div>

                    <div class="form-group">
                        <label for="tenantName">Nom du locataire <span class="required">*</span></label>
                        <input type="text" id="tenantName" required>
                        <div class="error-message" id="tenantNameError"></div>
                    </div>

                    <div class="form-group">
                        <label for="propertyAddress">Adresse du logement <span class="required">*</span></label>
                        <textarea id="propertyAddress" rows="3" required></textarea>
                        <div class="error-message" id="propertyAddressError"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="period">Période <span class="required">*</span></label>
                            <input type="text" id="period" placeholder="ex: Avril 2025" required>
                            <div class="error-message" id="periodError"></div>
                        </div>

                        <div class="form-group">
                            <label for="issueDate">Date d'émission <span class="required">*</span></label>
                            <input type="date" id="issueDate" required>
                            <div class="error-message" id="issueDateError"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="rentAmount">Montant du loyer (€) <span class="required">*</span></label>
                            <input type="number" id="rentAmount" min="0" step="0.01" required>
                            <div class="error-message" id="rentAmountError"></div>
                        </div>

                        <div class="form-group">
                            <label for="charges">Charges (€)</label>
                            <input type="number" id="charges" min="0" step="0.01" value="0">
                            <div class="error-message" id="chargesError"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="paymentMethod">Mode de paiement</label>
                            <select id="paymentMethod">
                                <option value="Virement">Virement bancaire</option>
                                <option value="Chèque">Chèque</option>
                                <option value="Espèces">Espèces</option>
                                <option value="Prélèvement">Prélèvement automatique</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="paymentReference">Référence du paiement</label>
                            <input type="text" id="paymentReference" placeholder="Optionnel">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="observations">Observations</label>
                        <textarea id="observations" rows="3" placeholder="Informations complémentaires (optionnel)"></textarea>
                    </div>

                    <div class="signature-section">
                        <h3>Signature électronique</h3>
                        <div class="signature-options">
                            <button type="button" class="signature-btn" id="uploadBtn">📁 Importer une image</button>
                            <button type="button" class="signature-btn" id="drawBtn">✏️ Dessiner</button>
                            <button type="button" class="signature-btn" id="clearSignatureBtn">🗑️ Effacer</button>
                        </div>

                        <input type="file" id="fileUpload" accept="image/*">
                        
                        <canvas id="signatureCanvas" width="400" height="150"></canvas>
                        <div class="canvas-controls">
                            <button type="button" id="clearCanvas">Effacer</button>
                            <button type="button" id="saveSignature">Valider</button>
                        </div>

                        <div class="signature-preview" id="signaturePreview">
                            <p>Aperçu de la signature :</p>
                            <img id="signatureImg" alt="Signature">
                        </div>
                    </div>
                </form>

                <button type="button" class="btn" id="generateBtn">📄 Générer et télécharger le PDF</button>
            </div>

            <div class="preview-section">
                <h2 class="section-title">👁️ Aperçu de la quittance</h2>
                
                <div class="preview-content" id="previewContent">
                    <div class="preview-header">
                        <h2>QUITTANCE DE LOYER</h2>
                        <p><strong>Location vide ou meublée à titre de résidence principale</strong></p>
                    </div>

                    <div class="preview-info">
                        <div class="preview-block">
                            <strong>Bailleur :</strong>
                            <div id="previewLandlordName">Nom du bailleur</div>
                            <div id="previewLandlordAddress">Adresse du bailleur</div>
                        </div>
                        
                        <div class="preview-block">
                            <strong>Locataire :</strong>
                            <div id="previewTenantName">Nom du locataire</div>
                        </div>
                    </div>

                    <div class="preview-block">
                        <strong>Adresse du logement :</strong>
                        <div id="previewPropertyAddress">Adresse du logement</div>
                    </div>

                    <div class="preview-content-main">
                        <p>
                            Je soussigné <strong id="previewLandlordNameInText">Nom du bailleur</strong>, propriétaire du logement désigné ci-dessus, 
                            déclare avoir reçu de Monsieur/Madame <strong id="previewTenantNameInText">Nom du locataire</strong>, 
                            la somme de <strong id="previewTotalAmount">0,00 euros</strong> 
                            (<strong id="previewTotalAmountWords">zéro euro</strong>), 
                            au titre du paiement du loyer et des charges pour la période de location 
                            <strong id="previewPeriodInText">période</strong> 
                            et lui en donne quittance, sous réserve de tous mes droits.
                        </p>
                    </div>

                    <div class="preview-details">
                        <h3>Détail du règlement :</h3>
                        <table>
                            <tr>
                                <td><strong>Loyer :</strong></td>
                                <td style="text-align: right;" id="previewRentAmount">0,00 €</td>
                            </tr>
                            <tr>
                                <td><strong>Provision pour charges :</strong></td>
                                <td style="text-align: right;" id="previewCharges">0,00 €</td>
                            </tr>
                            <tr>
                                <td><strong>Total :</strong></td>
                                <td style="text-align: right; font-weight: bold;" id="previewTotal">0,00 €</td>
                            </tr>
                        </table>

                        <div style="margin-top: 0.9375rem;">
                            <p><strong>Mode de paiement :</strong> <span id="previewPaymentMethod">Virement bancaire</span></p>
                            <p id="previewPaymentReferenceBlock" style="display: none;"><strong>Référence :</strong> <span id="previewPaymentReference"></span></p>
                            <p id="previewObservationsBlock" style="display: none;"><strong>Observations :</strong> <span id="previewObservations"></span></p>
                        </div>
                    </div>

                    <div class="preview-signature">
                        <div>
                            <p><strong>Fait à</strong> <span id="previewCity">_____________</span>, <strong>le</strong> <span id="previewDate">__/__/____</span></p>
                        </div>
                        <div>
                            <p><strong>Signature du bailleur :</strong></p>
                            <div class="signature-placeholder" id="previewSignaturePlaceholder">
                                Signature
                            </div>
                            <img class="signature-image" id="previewSignatureImg" style="display: none;" alt="Signature">
                        </div>
                    </div>

                    <div class="legal-text">
                        <p><small>
                            Article 21 de la loi n° 89-462 du 6 juillet 1989 : Le bailleur est tenu de transmettre gratuitement une quittance au locataire qui en fait la demande. 
                            La quittance porte le détail des sommes versées par le locataire en distinguant le loyer et les charges.
                        </small></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="help-section">
            <h3>💡 Guide d'utilisation</h3>
            <ul>
                <li><strong>Signature :</strong> Vous pouvez soit importer une image de votre signature (PNG, JPG, SVG), soit la dessiner directement avec votre souris ou votre doigt sur écran tactile.</li>
                <li><strong>Montants :</strong> Saisissez les montants en euros avec décimales si nécessaire (ex: 750.50).</li>
                <li><strong>Période :</strong> Indiquez la période concernée (ex: "Janvier 2025" ou "01/2025").</li>
                <li><strong>Génération PDF :</strong> Une fois tous les champs obligatoires remplis, cliquez sur "Générer et télécharger le PDF" pour obtenir votre quittance.</li>
                <li><strong>Aperçu :</strong> L'aperçu à droite vous montre en temps réel à quoi ressemblera votre quittance.</li>
            </ul>
        </div>

        <div class="footer">
            <p>🏠 Générateur de Quittance de Loyer</p>
            <p><small>MIT License - RIGEL CODJIA</small></p>
        </div>
    </div>

    <!-- jsPDF Library (version 2.5.1 minified) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Application principale
        class ReceiptGenerator {
            constructor() {
                this.signatureData = null;
                this.isDrawing = false;
                this.canvas = document.getElementById('signatureCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.initializeEventListeners();
                this.updatePreview();
                this.setCurrentDate();
                this.adjustCanvasForMobile();
                window.addEventListener('resize', () => this.adjustCanvasForMobile());
            }

            adjustCanvasForMobile() {
                if (window.innerWidth <= 480) {
                    this.canvas.width = Math.min(320, window.innerWidth - 40);
                    this.canvas.height = 120;
                } else {
                    this.canvas.width = 400;
                    this.canvas.height = 150;
                }
            }

            initializeEventListeners() {
                // Écouteurs pour la mise à jour de l'aperçu
                const inputs = ['landlordName', 'landlordAddress', 'tenantName', 'propertyAddress', 
                               'period', 'issueDate', 'rentAmount', 'charges', 'paymentMethod', 
                               'paymentReference', 'observations'];
                
                inputs.forEach(id => {
                    const element = document.getElementById(id);
                    element.addEventListener('input', () => this.updatePreview());
                    element.addEventListener('change', () => this.updatePreview());
                });

                // Signature
                document.getElementById('uploadBtn').addEventListener('click', () => this.showUploadOption());
                document.getElementById('drawBtn').addEventListener('click', () => this.showDrawOption());
                document.getElementById('clearSignatureBtn').addEventListener('click', () => this.clearSignature());
                document.getElementById('fileUpload').addEventListener('change', (e) => this.handleFileUpload(e));
                
                // Canvas pour dessiner
                this.canvas.addEventListener('mousedown', (e) => this.startDrawing(e));
                this.canvas.addEventListener('mousemove', (e) => this.draw(e));
                this.canvas.addEventListener('mouseup', () => this.stopDrawing());
                this.canvas.addEventListener('mouseout', () => this.stopDrawing());
                
                // Touch events pour mobile
                this.canvas.addEventListener('touchstart', (e) => this.startDrawing(e));
                this.canvas.addEventListener('touchmove', (e) => this.draw(e));
                this.canvas.addEventListener('touchend', () => this.stopDrawing());

                // Contrôles canvas
                document.getElementById('clearCanvas').addEventListener('click', () => this.clearCanvas());
                document.getElementById('saveSignature').addEventListener('click', () => this.saveCanvasSignature());

                // Génération PDF
                document.getElementById('generateBtn').addEventListener('click', () => this.generatePDF());
            }

            setCurrentDate() {
                const today = new Date();
                const dateString = today.toISOString().split('T')[0];
                document.getElementById('issueDate').value = dateString;
                this.updatePreview();
            }

            updatePreview() {
                // Mise à jour des informations de base
                document.getElementById('previewLandlordName').textContent = 
                    document.getElementById('landlordName').value || 'Nom du bailleur';
                document.getElementById('previewLandlordAddress').textContent = 
                    document.getElementById('landlordAddress').value || 'Adresse du bailleur';
                document.getElementById('previewTenantName').textContent = 
                    document.getElementById('tenantName').value || 'Nom du locataire';
                document.getElementById('previewPropertyAddress').textContent = 
                    document.getElementById('propertyAddress').value || 'Adresse du logement';

                // Mise à jour dans le texte
                document.getElementById('previewLandlordNameInText').textContent = 
                    document.getElementById('landlordName').value || 'Nom du bailleur';
                document.getElementById('previewTenantNameInText').textContent = 
                    document.getElementById('tenantName').value || 'Nom du locataire';
                document.getElementById('previewPeriodInText').textContent = 
                    document.getElementById('period').value || 'période';

                // Calculs financiers
                const rent = parseFloat(document.getElementById('rentAmount').value) || 0;
                const charges = parseFloat(document.getElementById('charges').value) || 0;
                const total = rent + charges;

                document.getElementById('previewRentAmount').textContent = this.formatCurrency(rent);
                document.getElementById('previewCharges').textContent = this.formatCurrency(charges);
                document.getElementById('previewTotal').textContent = this.formatCurrency(total);
                document.getElementById('previewTotalAmount').textContent = this.formatCurrency(total);
                document.getElementById('previewTotalAmountWords').textContent = this.numberToWords(total);

                // Mode de paiement
                document.getElementById('previewPaymentMethod').textContent = 
                    document.getElementById('paymentMethod').value;

                // Référence de paiement
                const paymentRef = document.getElementById('paymentReference').value;
                const paymentRefBlock = document.getElementById('previewPaymentReferenceBlock');
                if (paymentRef.trim()) {
                    document.getElementById('previewPaymentReference').textContent = paymentRef;
                    paymentRefBlock.style.display = 'block';
                } else {
                    paymentRefBlock.style.display = 'none';
                }

                // Observations
                const observations = document.getElementById('observations').value;
                const observationsBlock = document.getElementById('previewObservationsBlock');
                if (observations.trim()) {
                    document.getElementById('previewObservations').textContent = observations;
                    observationsBlock.style.display = 'block';
                } else {
                    observationsBlock.style.display = 'none';
                }

                // Date
                const issueDate = document.getElementById('issueDate').value;
                if (issueDate) {
                    const date = new Date(issueDate);
                    const formattedDate = date.toLocaleDateString('fr-FR');
                    document.getElementById('previewDate').textContent = formattedDate;
                    
                    // Extraction de la ville depuis l'adresse du bailleur
                    const landlordAddress = document.getElementById('landlordAddress').value;
                    const city = this.extractCity(landlordAddress);
                    document.getElementById('previewCity').textContent = city || '_____________';
                } else {
                    document.getElementById('previewDate').textContent = '__/__/____';
                }
            }

            extractCity(address) {
                if (!address) return '';
                const lines = address.split('\n');
                const lastLine = lines[lines.length - 1].trim();
                // Essaie d'extraire la ville de la dernière ligne (format: code postal + ville)
                const match = lastLine.match(/\d{5}\s+(.+)/);
                return match ? match[1] : '';
            }

            formatCurrency(amount) {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR'
                }).format(amount);
            }

            numberToWords(num) {
                if (num === 0) return 'zéro euro';
                
                const ones = ['', 'un', 'deux', 'trois', 'quatre', 'cinq', 'six', 'sept', 'huit', 'neuf'];
                const teens = ['dix', 'onze', 'douze', 'treize', 'quatorze', 'quinze', 'seize', 'dix-sept', 'dix-huit', 'dix-neuf'];
                const tens = ['', '', 'vingt', 'trente', 'quarante', 'cinquante', 'soixante', 'soixante-dix', 'quatre-vingt', 'quatre-vingt-dix'];
                const hundreds = ['', 'cent', 'deux-cents', 'trois-cents', 'quatre-cents', 'cinq-cents', 'six-cents', 'sept-cents', 'huit-cents', 'neuf-cents'];

                function convertHundreds(num) {
                    let result = '';
                    
                    if (num >= 100) {
                        result += hundreds[Math.floor(num / 100)];
                        num %= 100;
                        if (num > 0) result += ' ';
                    }
                    
                    if (num >= 20) {
                        result += tens[Math.floor(num / 10)];
                        num %= 10;
                        if (num > 0) result += '-' + ones[num];
                    } else if (num >= 10) {
                        result += teens[num - 10];
                    } else if (num > 0) {
                        result += ones[num];
                    }
                    
                    return result;
                }

                const integer = Math.floor(num);
                const decimal = Math.round((num - integer) * 100);

                let result = '';
                
                if (integer >= 1000) {
                    const thousands = Math.floor(integer / 1000);
                    result += convertHundreds(thousands) + ' mille ';
                    const remainder = integer % 1000;
                    if (remainder > 0) {
                        result += convertHundreds(remainder);
                    }
                } else {
                    result += convertHundreds(integer);
                }

                result += integer > 1 ? ' euros' : ' euro';

                if (decimal > 0) {
                    result += ' et ' + convertHundreds(decimal) + (decimal > 1 ? ' centimes' : ' centime');
                }

                return result;
            }

            // Gestion de la signature
            showUploadOption() {
                document.getElementById('uploadBtn').classList.add('active');
                document.getElementById('drawBtn').classList.remove('active');
                document.getElementById('fileUpload').click();
            }

            showDrawOption() {
                document.getElementById('uploadBtn').classList.remove('active');
                document.getElementById('drawBtn').classList.add('active');
                this.canvas.style.display = 'block';
                document.querySelector('.canvas-controls').style.display = 'flex';
                this.clearCanvas();
            }

            clearSignature() {
                this.signatureData = null;
                document.getElementById('signaturePreview').style.display = 'none';
                document.getElementById('previewSignatureImg').style.display = 'none';
                document.getElementById('previewSignaturePlaceholder').style.display = 'block';
                this.canvas.style.display = 'none';
                document.querySelector('.canvas-controls').style.display = 'none';
                document.getElementById('uploadBtn').classList.remove('active');
                document.getElementById('drawBtn').classList.remove('active');
            }

            handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                // Vérification du type de fichier
                if (!file.type.match(/image.*/)) {
                    alert('Veuillez sélectionner un fichier image (PNG, JPG, SVG).');
                    return;
                }

                // Vérification de la taille (2MB max)
                if (file.size > 2 * 1024 * 1024) {
                    alert('Le fichier est trop volumineux. Taille maximum : 2MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    this.signatureData = e.target.result;
                    this.showSignaturePreview(e.target.result);
                };
                reader.readAsDataURL(file);
            }

            showSignaturePreview(src) {
                const previewImg = document.getElementById('signatureImg');
                previewImg.src = src;
                document.getElementById('signaturePreview').style.display = 'block';
                
                const previewSignatureImg = document.getElementById('previewSignatureImg');
                previewSignatureImg.src = src;
                previewSignatureImg.style.display = 'block';
                document.getElementById('previewSignaturePlaceholder').style.display = 'none';
            }

            // Dessin sur canvas
            getMousePos(e) {
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;

                if (e.touches) {
                    return {
                        x: (e.touches[0].clientX - rect.left) * scaleX,
                        y: (e.touches[0].clientY - rect.top) * scaleY
                    };
                }
                
                return {
                    x: (e.clientX - rect.left) * scaleX,
                    y: (e.clientY - rect.top) * scaleY
                };
            }

            startDrawing(e) {
                e.preventDefault();
                this.isDrawing = true;
                const pos = this.getMousePos(e);
                this.ctx.beginPath();
                this.ctx.moveTo(pos.x, pos.y);
            }

            draw(e) {
                if (!this.isDrawing) return;
                e.preventDefault();
                
                const pos = this.getMousePos(e);
                this.ctx.lineWidth = 2;
                this.ctx.lineCap = 'round';
                this.ctx.strokeStyle = '#000';
                this.ctx.lineTo(pos.x, pos.y);
                this.ctx.stroke();
            }

            stopDrawing() {
                this.isDrawing = false;
            }

            clearCanvas() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }

            saveCanvasSignature() {
                const dataURL = this.canvas.toDataURL('image/png');
                this.signatureData = dataURL;
                this.showSignaturePreview(dataURL);
                this.canvas.style.display = 'none';
                document.querySelector('.canvas-controls').style.display = 'none';
            }

            // Validation du formulaire
            validateForm() {
                let isValid = true;
                const errors = [];

                // Champs obligatoires
                const requiredFields = [
                    { id: 'landlordName', name: 'Nom du bailleur' },
                    { id: 'landlordAddress', name: 'Adresse du bailleur' },
                    { id: 'tenantName', name: 'Nom du locataire' },
                    { id: 'propertyAddress', name: 'Adresse du logement' },
                    { id: 'period', name: 'Période' },
                    { id: 'issueDate', name: 'Date d\'émission' },
                    { id: 'rentAmount', name: 'Montant du loyer' }
                ];

                requiredFields.forEach(field => {
                    const element = document.getElementById(field.id);
                    const errorElement = document.getElementById(field.id + 'Error');
                    
                    if (!element.value.trim()) {
                        isValid = false;
                        errors.push(`${field.name} est obligatoire`);
                        errorElement.textContent = 'Ce champ est obligatoire';
                        errorElement.style.display = 'block';
                        element.style.borderColor = '#e74c3c';
                    } else {
                        errorElement.style.display = 'none';
                        element.style.borderColor = '#e1e5e9';
                    }
                });

                // Validation des montants
                const rentAmount = parseFloat(document.getElementById('rentAmount').value);
                const charges = parseFloat(document.getElementById('charges').value) || 0;

                if (isNaN(rentAmount) || rentAmount < 0) {
                    isValid = false;
                    errors.push('Le montant du loyer doit être un nombre positif');
                    document.getElementById('rentAmountError').textContent = 'Montant invalide';
                    document.getElementById('rentAmountError').style.display = 'block';
                }

                if (charges < 0) {
                    isValid = false;
                    errors.push('Le montant des charges doit être positif ou nul');
                    document.getElementById('chargesError').textContent = 'Montant invalide';
                    document.getElementById('chargesError').style.display = 'block';
                }

                // Validation de la date
                const issueDate = new Date(document.getElementById('issueDate').value);
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                if (issueDate > today) {
                    isValid = false;
                    errors.push('La date d\'émission ne peut pas être dans le futur');
                    document.getElementById('issueDateError').textContent = 'Date invalide';
                    document.getElementById('issueDateError').style.display = 'block';
                }

                // Affichage des erreurs
                const validationMessage = document.getElementById('validationMessage');
                if (!isValid) {
                    validationMessage.innerHTML = '<strong>Erreurs de validation :</strong><br>' + errors.join('<br>');
                    validationMessage.style.display = 'block';
                    validationMessage.scrollIntoView({ behavior: 'smooth' });
                } else {
                    validationMessage.style.display = 'none';
                }

                return isValid;
            }

            // Fonction pour nettoyer le nom de fichier
            sanitizeFilename(filename) {
                return filename.replace(/[^a-z0-9]/gi, '_').replace(/_+/g, '_').toLowerCase();
            }

            // Génération du PDF
            generatePDF() {
                if (!this.validateForm()) {
                    return;
                }

                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();

                    // Configuration des fonts et couleurs
                    doc.setFont('times', 'normal');
                    
                    // En-tête
                    doc.setFontSize(18);
                    doc.setFont('times', 'bold');
                    doc.text('QUITTANCE DE LOYER', 105, 25, { align: 'center' });
                    
                    doc.setFontSize(12);
                    doc.setFont('times', 'normal');
                    doc.text('Location vide ou meublée à titre de résidence principale', 105, 35, { align: 'center' });

                    // Informations bailleur et locataire
                    doc.setFontSize(11);
                    doc.setFont('times', 'bold');
                    doc.text('Bailleur :', 20, 55);
                    doc.setFont('times', 'normal');
                    const landlordInfo = [
                        document.getElementById('landlordName').value,
                        ...document.getElementById('landlordAddress').value.split('\n')
                    ];
                    landlordInfo.forEach((line, index) => {
                        doc.text(line, 20, 65 + (index * 6));
                    });

                    doc.setFont('times', 'bold');
                    doc.text('Locataire :', 120, 55);
                    doc.setFont('times', 'normal');
                    doc.text(document.getElementById('tenantName').value, 120, 65);

                    // Adresse du logement
                    doc.setFont('times', 'bold');
                    doc.text('Adresse du logement :', 20, 105);
                    doc.setFont('times', 'normal');
                    const propertyLines = document.getElementById('propertyAddress').value.split('\n');
                    propertyLines.forEach((line, index) => {
                        doc.text(line, 20, 115 + (index * 6));
                    });

                    // Corps du texte
                    const landlordName = document.getElementById('landlordName').value;
                    const tenantName = document.getElementById('tenantName').value;
                    const period = document.getElementById('period').value;
                    const rent = parseFloat(document.getElementById('rentAmount').value) || 0;
                    const charges = parseFloat(document.getElementById('charges').value) || 0;
                    const total = rent + charges;

                    const mainText = `Je soussigné ${landlordName}, propriétaire du logement désigné ci-dessus, déclare avoir reçu de Monsieur/Madame ${tenantName}, la somme de ${this.formatCurrency(total)} (${this.numberToWords(total)}), au titre du paiement du loyer et des charges pour la période de location ${period} et lui en donne quittance, sous réserve de tous mes droits.`;

                    doc.setFont('times', 'normal');
                    doc.setFontSize(11);
                    const splitText = doc.splitTextToSize(mainText, 170);
                    doc.text(splitText, 20, 145);

                    // Détail du règlement
                    let currentY = 145 + (splitText.length * 6) + 15;
                    
                    doc.setFont('times', 'bold');
                    doc.text('Détail du règlement :', 20, currentY);
                    currentY += 10;

                    // Tableau des montants
                    doc.setFont('times', 'normal');
                    doc.text('Loyer :', 25, currentY);
                    doc.text(this.formatCurrency(rent), 160, currentY, { align: 'right' });
                    currentY += 8;

                    doc.text('Provision pour charges :', 25, currentY);
                    doc.text(this.formatCurrency(charges), 160, currentY, { align: 'right' });
                    currentY += 8;

                    doc.line(25, currentY, 160, currentY);
                    currentY += 5;

                    doc.setFont('times', 'bold');
                    doc.text('Total :', 25, currentY);
                    doc.text(this.formatCurrency(total), 160, currentY, { align: 'right' });
                    currentY += 15;

                    // Informations de paiement
                    doc.setFont('times', 'normal');
                    doc.text(`Mode de paiement : ${document.getElementById('paymentMethod').value}`, 20, currentY);
                    currentY += 8;

                    const paymentRef = document.getElementById('paymentReference').value;
                    if (paymentRef.trim()) {
                        doc.text(`Référence : ${paymentRef}`, 20, currentY);
                        currentY += 8;
                    }

                    const observations = document.getElementById('observations').value;
                    if (observations.trim()) {
                        doc.text('Observations :', 20, currentY);
                        currentY += 6;
                        const obsText = doc.splitTextToSize(observations, 170);
                        doc.text(obsText, 20, currentY);
                        currentY += obsText.length * 6;
                    }

                    // Date et signature
                    currentY += 20;
                    const issueDate = new Date(document.getElementById('issueDate').value);
                    const city = this.extractCity(document.getElementById('landlordAddress').value) || '';
                    
                    doc.text(`Fait à ${city}, le ${issueDate.toLocaleDateString('fr-FR')}`, 20, currentY);
                    
                    doc.text('Signature du bailleur :', 120, currentY);

                    // Ajout de la signature si présente
                    if (this.signatureData) {
                        try {
                            doc.addImage(this.signatureData, 'PNG', 120, currentY + 5, 60, 25);
                        } catch (error) {
                            console.warn('Erreur lors de l\'ajout de la signature:', error);
                        }
                    }

                    // Mentions légales
                    doc.setFontSize(9);
                    doc.text('Article 21 de la loi n° 89-462 du 6 juillet 1989 : Le bailleur est tenu de transmettre gratuitement', 20, 280);
                    doc.text('une quittance au locataire qui en fait la demande. La quittance porte le détail des sommes', 20, 286);
                    doc.text('versées par le locataire en distinguant le loyer et les charges.', 20, 292);

                    // Génération du nom de fichier
                    const sanitizedTenantName = this.sanitizeFilename(tenantName);
                    const dateStr = issueDate.toISOString().split('T')[0];
                    const filename = `quittance_${sanitizedTenantName}_${dateStr}.pdf`;

                    // Téléchargement
                    doc.save(filename);

                    // Message de succès
                    const successMessage = document.getElementById('successMessage');
                    successMessage.textContent = `Quittance générée avec succès ! Fichier : ${filename}`;
                    successMessage.style.display = 'block';
                    successMessage.scrollIntoView({ behavior: 'smooth' });

                    // Masquer le message après 5 secondes
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 5000);

                } catch (error) {
                    console.error('Erreur lors de la génération du PDF:', error);
                    alert('Erreur lors de la génération du PDF. Veuillez vérifier vos données et réessayer.');
                }
            }
        }

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', () => {
            new ReceiptGenerator();
        });
    </script>
</body>
</html>